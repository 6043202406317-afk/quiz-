<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>クイズアプリ</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .bg-it { background: #e3f2fd; }
    .bg-physics { background: #e8f5e9; }
    .bg-english { background: #fff3e0; }

    #home, #quiz {
      padding: 30px;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #choices button {
      display: block;
      width: 80%;
      margin: 10px auto;
    }

    .correct {
      background-color: #8bc34a;
      color: white;
    }

    .wrong {
      background-color: #f44336;
      color: white;
    }
  </style>
</head>
<body id="body">

<div id="home">
  <h1>クイズアプリ</h1>
  <button onclick="startQuiz('it')">IT</button>
  <button onclick="startQuiz('physics')">物理</button>
  <button onclick="startQuiz('english')">英語</button>
</div>

<div id="quiz" style="display:none;">
  <h2 id="question"></h2>
  <div id="choices"></div>
  <p id="result"></p>
  <p id="explanation"></p>
  <p id="rate"></p>
  <button onclick="nextQuestion()">次へ</button>
  <button onclick="goHome()">ホームに戻る</button>
</div>

<script>
const quizData = {
  it: [
    {
      q: "CPUの役割はどれ？",
      c: ["記憶", "演算", "表示", "印刷"],
      a: 1,
      e: "CPUは計算や処理（演算）を行う装置です。"
    }
  ],
  physics: [
    {
      q: "速度の単位は？",
      c: ["m", "m/s", "kg", "N"],
      a: 1,
      e: "速度は距離÷時間なので m/s です。"
    }
  ],
  english: [
    {
      q: "apple の意味は？",
      c: ["犬", "りんご", "走る", "青い"],
      a: 1,
      e: "apple は「りんご」という意味です。"
    }
  ]
};

let questions = [];
let order = [];
let currentIndex = 0;
let correctCount = 0;
let answerCount = 0;
let hasCounted = false;

function startQuiz(type) {
  questions = quizData[type];
  correctCount = 0;
  answerCount = 0;
  currentIndex = 0;

  document.getElementById("home").style.display = "none";
  document.getElementById("quiz").style.display = "block";
  document.getElementById("body").className = "bg-" + type;

  shuffle();
  showQuestion();
}

function shuffle() {
  order = [...Array(questions.length).keys()];
  for (let i = order.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [order[i], order[j]] = [order[j], order[i]];
  }
}

function showQuestion() {
  hasCounted = false;
  document.getElementById("result").textContent = "";
  document.getElementById("explanation").textContent = "";
  document.getElementById("rate").textContent = "";

  const q = questions[order[currentIndex]];
  document.getElementById("question").textContent = q.q;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  q.c
    .map((text, index) => ({ text, index }))
    .sort(() => Math.random() - 0.5)
    .forEach(choice => {
      const btn = document.createElement("button");
      btn.textContent = choice.text;
      btn.onclick = () => checkAnswer(choice.index, btn);
      choicesDiv.appendChild(btn);
    });
}

function checkAnswer(selectedIndex, btn) {
  if (hasCounted) return;

  const q = questions[order[currentIndex]];

  if (selectedIndex === q.a) {
    btn.classList.add("correct");
    document.getElementById("result").textContent = "⭕ 正解！";
  } else {
    btn.classList.add("wrong");
    document.getElementById("result").textContent = "❌ 不正解";
  }

  hasCounted = true;
  answerCount++;
  if (selectedIndex === q.a) correctCount++;

  const rate = Math.round((correctCount / answerCount) * 100);
  document.getElementById("rate").textContent =
    `正答率：${rate}%（${correctCount}/${answerCount}）`;

  document.getElementById("explanation").textContent = "解説：" + q.e;
}

function nextQuestion() {
  currentIndex++;
  if (currentIndex >= order.length) {
    alert("クイズ終了！");
    goHome();
  } else {
    showQuestion();
  }
}

function goHome() {
  document.getElementById("quiz").style.display = "none";
  document.getElementById("home").style.display = "block";
  document.getElementById("body").className = "";
}
</script>

</body>
</html>
